---
title: "Informe 2 - Grupo 2 - Sección 4"
format: html
editor: visual
author: "Miranda Salazar, Antoni Cotrina, Alexandro Silva, Eloy Nunayalle"
embed-resources: true
---

# PG1 - Informe

```{r, echo=FALSE, results='hide'}
# Verificar e instalar tidyverse si no está instalado
if (!require(tidyverse)) install.packages("tidyverse", dependencies = TRUE); library(tidyverse)

# Verificar e instalar ggplot2 si no está instalado
if (!require(ggplot2)) install.packages("ggplot2", dependencies = TRUE); library(ggplot2)

# Verificar e instalar plotrix si no está instalado
if (!require(plotrix)) install.packages("plotrix", dependencies = TRUE); library(plotrix)

# Verificar e instalar VennDiagram si no está instalado
if (!require(VennDiagram)) install.packages("VennDiagram", dependencies = TRUE); library(VennDiagram)

```

```{r, echo=FALSE, results='hide'}
i <- 1
```

```{r, echo=FALSE, results='hide'}
DF <- read_csv("datos_cafe_limpios.csv")
```

## 1. Introducción

### 1.1. Relevancia

Estando el consumo de café tan presente en la vida cotidiana, por una variedad de razones, es importante analizar tanto los hábitos de consumo asociados a él como sus impactos.

### 1.2. Objetivos

General: Investigar sobre el consumo de café y su impacto en los estudiantes de pregrado de la Universidad de Ingeniería y Tecnología (UTEC) durante el semestre académico 2024-II

Específicos:

1.  Averiguar el impacto autopercibido del café en el rendimiento académico de los estudiantes de UTEC.

2.  Averiguar los hábitos de consumo de los estudiantes de UTEC respecto al café y determinar la presencia de una cultura cafetera.

## 2. Contexto

La población objetivo son los estudiantes de pregrado en UTEC que consumen café. Se utilizó un muestreo aleatorio simple. Los datos se recolectaron del 16 al 24 de septiembre mediante una encuesta en línea accesible por un QR en la universidad. La encuesta tenía preguntas generales y específicas, filtrando con una pregunta sobre el consumo de café dando así una fuente de datos primaria.

### 2.1. Variables

De las 44 variables disponibles, seleccionamos las siguientes, organizadas según los objetivos:

**Objetivo 1 (5 variables)**

1.  **Continua**:

    ```{r, echo=FALSE}
    # Promedio ponderado de los estudiantes, en un rango de 0 a 20
    Promedio <- DF$Promedio
    cat("Promedio:", head(Promedio, 10), "\n")

    ```

2.  **Discretas**:

    ```{r, echo=FALSE}
    # Tazas de café diarias antes de ingresar a la universidad, rango de 0 a 20 tazas
    Consumo_antes_univ <- DF$Consumo_antes_univ
    cat("Consumo antes de la universidad:", head(Consumo_antes_univ, 10), "\n")

    # Tazas de café consumidas en un día de examen, máximo 30 tazas
    Consumo_examen_dia <- DF$Consumo_examen_dia
    cat("Consumo en día de examen:", head(Consumo_examen_dia, 10), "\n")

    ```

3.  **Ordinal**:

    ```{r, echo=FALSE}
    # Tiempo adicional de estudio tras consumir café, con opciones ordenadas
    Tiempo_extra_cafe <- factor(DF$Tiempo_estudio_extra_cafe, levels = c("No dedico tiempo extra", 
                                                                 "Menos de 20 minutos", 
                                                                 "Entre 20 a 40 minutos", 
                                                                 "Más de 40 minutos"), 
                                                                 ordered = TRUE)
    cat("Tiempo extra de estudio:", head(Tiempo_extra_cafe, 10), "\n")

    ```

4.  **Nominal**:

    ```{r, echo=FALSE}
    # Estado anímico al consumir café, con varias opciones
    Animo_cafe <- factor(DF$Animo_cafe, levels = c("Despierto", "Ansioso", "Concentrado", 
                                                   "Estresado", "Somnoliento", 
                                                   "Sin diferencia/neutral", "Feliz"))
    cat("Ánimo al consumir café:", head(Animo_cafe, 10), "\n")

    ```

**Objetivo 2 (5 variables)**

1.  **Continua**:

    ```{r, echo=FALSE}
    # Gasto semanal en café, con un límite máximo de 300 soles
    Gasto_semanal_cafe <- DF$Gasto_semanal_cafe
    cat("Gasto semanal en café:", head(Gasto_semanal_cafe, 10), "\n")

    ```

2.  **Discreta**:

    ```{r, echo=FALSE}
    # Tazas de café consumidas semanalmente, de 0 a 100
    Tazas_por_dia <- DF$Tazas_por_dia
    cat("Tazas de café por día:", head(Tazas_por_dia, 10), "\n")

    ```

3.  **Ordinal**:

    ```{r, echo=FALSE}
    # Frecuencia de reuniones en cafeterías, con opciones ordenadas
    Frecuencia_Reunion <- factor(DF$Frecuencia_reunion, levels = c("Nunca", "Rara vez", 
                                                                   "Algunas veces", 
                                                                   "Siempre"), 
                                                                   ordered = TRUE)
    cat("Frecuencia de reuniones en cafeterías:", head(Frecuencia_Reunion, 10), "\n")

    # Visitas semanales a cafeterías, con opciones de 0 a "4 o más"
    Frecuencia_cafeterias_semana <- factor(DF$Frecuencia_cafeterias_semana, levels = c("0", "1", "2", "3", "4 o más"), 
                                                                                     ordered = TRUE)
    cat("Frecuencia de visitas semanales a cafeterías:", head(Frecuencia_cafeterias_semana, 10), "\n")

    ```

4.  **Nominal**:

    ```{r, echo=FALSE}
    # Lugar habitual de compra de café
    Establecimiento_compra <- factor(DF$Establecimiento_compra, levels = c("Bodegas como Listo, Tambo", 
                                                                           "Starbucks", 
                                                                           "Hago mi propio café", 
                                                                           "Cafetería artesanal"))
    cat("Establecimiento de compra de café:", head(Establecimiento_compra, 10), "\n")

    ```

**Variables generales**: - **Ciclo**: Ciclo académico, variable numérica discreta (mínimo 1). - **Consume_cafe**: Variable lógica sobre el consumo de café (sí/no).

## 3. Análisis descriptivo

```{r, echo=FALSE}
calcular_moda <- function(x) {
  uniq_x <- unique(x)
  uniq_x[which.max(tabulate(match(x, uniq_x)))]
}
sd_cv <- function(data) {
  sd_value <- sd(data, na.rm = T)               
  mean_value <- mean(data, na.rm = T)           
  cv <- (sd_value / mean_value) * 100 
  
  print(paste0("La desviación estándar es:", round(sd_value, 2)))
  print(paste0("El coeficiente de variación es:", round(cv, 2), "%"))
}

r <- function(x) {
  round(x,2)
}
```

#### 3.1.1. Objetivo 1

#### Promedio

```{r, echo=FALSE, results='asis'}
boxplot(DF$Promedio, horizontal = T, main = paste0("Gráfico 1.", i))
title(sub = "Boxplot de la variable Promedio")  # Subtítulo
i <- i + 1
hist(DF$Promedio, main = paste0("Gráfico 1.", i)) 
title(sub = "Histograma de la variable Promedio (0-20)")  # Subtítulo
i <- i + 1
```

```{r, echo=FALSE, results='asis'}
summary(DF$Promedio)
```

```{r, echo=FALSE, results='asis'}
"Rango:"
max(DF$Promedio, na.rm=T) - min(DF$Promedio, na.rm=T)
```

```{r, echo=FALSE, results='asis'}
sd_cv(DF$Promedio)
```

-   El boxplot indica que la variable es asimétrica a la izquierda, con un coeficiente de variación menor a 30, lo que valida el uso de la media como descriptor. El rango de las notas va de 0 a 20, incluyendo tanto la peor como la mejor calificación. La media es 14.6 y la moda, superior, es aproximadamente 15. El primer cuartil es 13.60, indicando que más del 75% tiene un promedio aprobatorio. Esto sugiere que el consumo de café no está asociado con un bajo rendimiento académico en la mayoría de los estudiantes.

#### Consumo antes del ingreso a la universidad

```{r, echo=FALSE, results='asis'}
hist(DF$Consumo_antes_univ, breaks = 10, main = paste0("Gráfico 1.", i))
title(sub = "Histograma del consumo de café en tazas antes del ingreso a la universidad")
i <- i + 1
```

-   El consumo de tazas de café diarias antes de la universidad es una variable numérica discreta. El histograma muestra que es una variable asimétrica a la derecha (los valores están concentrados a la izquierda).

```{r, echo=FALSE, results='asis'}
summary(DF$Consumo_antes_univ)
sd_cv(DF$Consumo_antes_univ)
```

-   Además, el coeficiente de variación es bastante alto, por lo cual el descriptor de posición adecuado es la mediana.

-   Sabiendo eso, ¿qué podemos decir sobre la variable? El histograma muestra que la mayoría de personas que actualmente toman café, o no consumían café antes de entrar a la universidad (al ser el primer cuartil 0, significando que, como mínimo, un 25% empezó a tomar café habiendo entrado a la universidad), o consumían, como máximo, una taza de café al día.

```{r, echo=FALSE, results='asis'}
quantile(DF$Consumo_antes_univ, 0.75)
```

-   El tercer cuartil (3), es bajo en comparación al rango total (20), dejando un margen amplio de incremento en las siguientes variables.

#### Consumo examen día

```{r, echo=FALSE, results='asis'}
hist(DF$Consumo_examen_dia, main = paste0("Gráfico 1.", i))
title(sub = "Histograma de el consumo de café por tazas en día de examen")
i <- i+ 1
```

```{r, echo=FALSE, results='asis'}
"Rango:"
max(DF$Consumo_examen_dia, na.rm=T) - min(DF$Consumo_examen_dia, na.rm=T)
```

-   La variable original tenía muchos valores inverosímiles, como "31" tazas, que no podían corregirse fácilmente. Por ello, limitamos los valores a menos de 30, aunque esto todavía resultó en un rango grande de 26.

    El histograma muestra que la mayoría de los valores son mucho menores, con la mayor concentración entre 0 y 5 tazas, haciendo que la variable sea asimétrica a la derecha.

```{r}
sd_cv(DF$Consumo_examen_dia)
```

-   El coeficiente de variación es extremadamente alto (87,85%), por lo cual, el descriptor de posición adecuado es la mediana.

```{r}
summary(DF$Consumo_examen_dia)
```

-   La mediana es 3 (3 veces mayor al consumo antes de ingresar). Eso significa que, como mínimo, el 50% de estudiantes universitarios consume 3 tazas de café en un día de examen, que es bastante.

    ```{r}
    quantile(DF$Consumo_examen_dia, 0.75, na.rm=T)
    ```

-   El tercer cuartil, además, es 4, por lo que, como mínimo, un 75% de estudiantes de UTEC consumen 4 tazas de café en un día de examen.

#### Tiempo extra café

```{r, echo=FALSE, results='asis'}
# Definir el factor con niveles ordenados
F_Tiempo_estudio_extra <- factor(DF$Tiempo_estudio_extra_cafe, 
                                 levels = c("No dedico tiempo extra", "Menos de 20 minutos", "Entre 20 a 40 minutos", "Más de 40 minutos"),
                                 ordered = TRUE)

# Calcular las frecuencias
frecuencias <- table(F_Tiempo_estudio_extra)

# Crear el gráfico de barras
barp <- barplot(frecuencias,
                main = paste0("Gráfico 1.", i),
                col = "lightgray",
                
                xlab = "Categorías", 
                ylab = "Frecuencia Absoluta", 
                names.arg = c("No dedico tiempo extra", "Menos de 20 minutos", "Entre 20 a 40 minutos", "Más de 40 minutos"),
                las = 1,  # las = 2 para etiquetas de texto diagonal
                cex.names = 0.6, 
                ylim = c(0, max(frecuencias) + 10))  # Ajuste del límite del eje y para más espacio

# Añadir etiquetas de frecuencia encima de cada barra
text(barp, frecuencias/2, labels = frecuencias, pos = 3, cex = 1, col = "black")

title(sub = 
                "Gráfico del Tiempo Extra de Estudio después de Consumir Café")
i <- i + 1


```

```{r, echo=FALSE, results='asis'}
table(DF$Tiempo_estudio_extra_cafe)
```

```{r, echo=FALSE, results='asis'}
quantile(F_Tiempo_estudio_extra, 0.5 , type = 3,na.rm = TRUE)
```

-   La mediana del tiempo de estudio extra es "Entre 20 a 40 minutos", indicando que el 50% de los estudiantes dedican este tiempo o menos después de consumir café. La opción "Más de 40 minutos" es la más común, con 549 respuestas, mientras que "Menos de 20 minutos" es la menos frecuente, con 155 respuestas. Esto sugiere que una gran parte de los estudiantes asocia el consumo de café con un incremento notable en su tiempo de estudio.

#### Ánimo café

```{r, echo=FALSE, results='asis'}
frequencies <- table(DF$Animo_cafe)
total <- sum(frequencies)
percentages <- (frequencies / total) * 100


barplot_height <- barplot(frequencies, 
                          col = "gray90",  
                          ylim = c(0, max(frequencies) + 2),  
                          main = paste0("Gráfico 1.", i),
                          xlab = "Gráfico de caja de la variable ánimo", 
                          ylab = "Frecuencia", 
                          names.arg = names(frequencies), 
                          las = 1,
                          cex.names = 0.6)  

i <- i + 1

text(x = barplot_height, 
     y = frequencies + 0.5,  
     labels = frequencies, 
     pos = 3, 
     cex = 0.7, 
     xpd = TRUE)  

barplot_height <- barplot(frequencies, 
                          col = "gray90",  
                          ylim = c(0, max(frequencies) + 2),  
                          main= paste0("Gráfico 1.", i),
                          xlab = "Gráfico de barras de la variable ánimo, con porcentajes", 
                          ylab = "Frecuencia", 
                          names.arg = names(frequencies), 
                          las = 1,
                          cex.names = 0.6)  
text(x = barplot_height, 
     y = frequencies + 0.5,  # Colocar el texto a la mitad de la altura de la barra
     labels = paste0(round(percentages, 1), "%"),
     pos = 3, 
     cex = 0.7, 
     xpd = TRUE)  
i <- i + 1
```

-   Se puede afirmar que el estado que la mayoría de encuestados tiene después de tomar café es "Despierto" (38.2%).

-   El estado de ánimo con menor frecuencia en la muestra es "Feliz" (1.2%).

#### 3.1.2. Objetivo 2

```{r, echo=FALSE}
i <- 1
```

#### Gasto semanal café

```{r, echo=FALSE}

boxplot(DF$Gasto_semanal_cafe, horizontal = TRUE, main = paste0("Gráfico 2.", i), xlab = "Gráfico de caja del gasto semanal en café", col = "gray90") 

abline(v = mean(DF$Gasto_semanal_cafe, na.rm = TRUE), col = "red", lwd = 1, lty = 2) 

moda_gasto <- calcular_moda(DF$Gasto_semanal_cafe) # Añadir línea de la moda
abline(v = moda_gasto, col = "blue", lwd = 1, lty = 2) 

legend("topright", legend = c("Media", "Moda"), col = c("red", "blue"), lty = 2, lwd = 2) 
i <- i + 1

```

```{r, echo=FALSE, results='asis'}
summary(DF$Gasto_semanal_cafe)
calcular_moda(DF$Gasto_semanal_cafe)
```

```{r}
sd_cv(DF$Gasto_semanal_cafe)
```

```{r}
stats <- boxplot.stats(DF$Gasto_semanal_cafe)
stats$stats
```

```{r, echo=FALSE, results='asis'}
cat("Outliers:", sort(stats$out), "\n")
cat("Cantidad:", length(stats$out), "\n")
```

-   El gráfico 2.1 muestra que la distribución de los datos es asimétrica a la derecha. El 50% de los estudiantes que toman café gastan como máximo 12 soles semanalmente. El Q3 indica que el 75% gasta menos de 24 soles. El rango intercuartílico (Q1 a Q3) muestra que el 50% gasta entre 5 y 24 soles.

#### Tazas por día

```{r, echo=FALSE, results='asis'}
datos <- DF$Tazas_por_dia[DF$Tazas_por_dia >= 0 & !is.na(DF$Tazas_por_dia)]

# Gráfico de barras
barplot(table(datos), 
        main = paste0("Gráfico 2.", i), 
        xlab = "A. Gráfico de barras de consumo de tazas por día", 
        ylab = "Frecuencia", 
        col = "gray90", 
        border = "black", 
        ylim = c(0, 400))

i<-i+1

# Boxplot
boxplot(datos, horizontal = TRUE, 
        main = paste0("Gráfico 2.", i), 
        xlab = "B. Gráfico de caja de consumo de tazas por día",
        col = "gray90", 
        border = "black")
abline(v = mean(datos, na.rm = TRUE), col = "red", lwd = 2, lty = 2)
abline(v = calcular_moda(datos), col = "blue", lwd = 2, lty = 2)
legend("topright", legend = c("Media", "Moda"), col = c("red", "blue"), lty = 2, lwd = 2)

i<-i+1
```

```{r, echo=FALSE}
summary(datos)
print(paste0("El tamaño total de la variable es: ",length(datos)))
print(paste0("El tamaño efectivo de la variable es: ", sum(!is.na(datos))))
calcular_moda(datos)
```

-   El 50% (mediana) de la muestra consume como máximo 2 tazas por día y el 75% de la muestra consume como máximo 3. La moda es 1, lo que significa que la mayor parte de los estudiantes encuestados solo consume 1 taza de café por día. Los valores máximos y mínimos son 0 y 15 respectivamente, siendo 0 un valor nulo correspondiente a las personas que no consumen café diariamente.

```{r}
sd_cv(datos)
```

-   El gráfico A muestra que la mayoría de los valores están concentrados alrededor de la mediana (2). El coeficiente de variación es 87.29%, indicando una considerable dispersión en los datos. El gráfico B refuerza esto al mostrar que los valores superiores a 7 representan solo el 1.77% del total, lo que sugiere que la mayoría consume alrededor de 2 tazas de café al día, aunque existe una variedad en los patrones de consumo.

#### Frecuencia reunión

```{r, echo=FALSE}
F_Frecuencia_reunion <- factor(DF$Frecuencia_reunion, 
                               levels = c("Nunca", "Rara vez", "Algunas veces", "Siempre"),
                               ordered = TRUE)
frecuencias <- sort(table(F_Frecuencia_reunion))

barp <- barplot(frecuencias,
                main = paste0("Gráfico 2.", i), 
                col = "lightgray",
                xlab = "Gráfico de barras de la frecuencia de reunión en cafeterías", 
                ylab = "Frecuencia Absoluta",
                ylim = c(0, max(frecuencias) + 10))  

i<-i+1
# Agregar las frecuencias encima de las barras
text(x = barp, 
     y = frecuencias + 1, 
     labels = frecuencias, 
     cex = 0.8,  
     col = "black",  
     pos = 3,  
     xpd = TRUE)  
```

-   El gráfico de barras muestra que *"Rara vez"* es la opción más común (525 respuestas), mientras que *"Siempre"* es la menos frecuente (40). Esto refuerza la idea de que las reuniones para tomar café son poco frecuentes entre los estudiantes, limitando la presencia de una cultura cafetera en UTEC.

#### Frecuencia cafeterías semana

```{r, echo=FALSE, results='asis'}
DF_cafeteria <- DF
DF_cafeteria$Frecuencia_cafeterias_semana[DF_cafeteria$Frecuencia_cafeterias_semana == "4 a más"] <- 4
DF_cafeteria$Frecuencia_cafeterias_semana <- as.numeric(DF_cafeteria$Frecuencia_cafeterias_semana)
frequencias <- table(DF_cafeteria$Frecuencia_cafeterias_semana)


# Crear gráfico de mosaico con leyenda
mosaicplot(frequencias, 
           main = paste0("Gráfico 2.", i),  
           col = c("gray90", "gray80", "gray70", "gray60", "gray50"),  # Colores
           xlab = "Gráfico de mosaicos de la frecuencia de visita a cafeterías por semana", 
           ylab = "Proporción", 
           las = 1,  # Etiquetas horizontales en el eje x
           )  

i<-i+1

```

```{r, echo=FALSE, results='asis'}
frequencias
```

```{r}
median(DF_cafeteria$Frecuencia_cafeterias_semana, na.rm=T)
```

La mayoría de respuestas estuvieron concentradas en los menores valores siguiendo la jerarquía de la variable (0 veces, 1 vez, 2 veces, 3 veces, 4+ veces). La mediana, sacada convirtiendo la variable a numérica cambiando el 4+ a 4, termina de demostrar esto: es de 1. Eso implica que, como mínimo, un 50% de las personas que toman café va, como máximo, una vez a la semana a una cafetería.

```{r}
quantile(DF_cafeteria$Frecuencia_cafeterias_semana, 0.25)
quantile(DF_cafeteria$Frecuencia_cafeterias_semana, 0.75)
```

El tercer cuartil es de 2 veces a la semana, significando que un 75% de todas las personas que toman café van, como máximo, 2 veces a la semana a una cafetería.

#### Establecimientos de compra

```{r, echo=FALSE, results='asis'}
# Crear tabla de frecuencias
mosaic_data <- table(DF$Establecimiento_compra)

# Crear gráfico de mosaico
mosaicplot(mosaic_data, 
           main = paste0("Gráfico 2.", i), 
           xlab = "Gráfico de mosaicos de los establecimientos de compra", 
           ylab = "Frecuencia", 
           col = c("gray90", "gray80", "gray70", "gray60"), 
           las = 1, 
           cex.axis = 0.5)  # Ajustar el tamaño de las etiquetas del eje y

# Calcular posiciones para las etiquetas
```

-   La opción de hacer café en casa es la más popular, representando el 45.52% de la muestra.

-   Existe una menor elección por las cafeterías artesanales (12.27%) y Starbucks (14.25%), que suelen ser opciones más costosas.

### 3.2. Análisis de interacción

#### 3.2.1. Objetivo 1

#### Tazas por día y promedio

```{r, echo=FALSE, results='asis'}
i<-1
correlacion_total <- cor(DF$Tazas_por_dia, DF$Promedio, use = "complete.obs")
print(paste0("Coeficiente de correlación entre Tazas por día y Promedio académico:", correlacion_total))

DF_naomit <- na.omit(DF)

# Establecer la ecuación de regresión lineal
modelo <- lm(DF_naomit$Promedio~DF_naomit$Tazas_por_dia)
intercepto <- coef(modelo)[1]
pendiente <- coef(modelo)[2]
paste0("La ecuación de regresión para un modelo lineal es: y = ",pendiente,"x + ",intercepto)

# Crear el gráfico
ggplot(DF_naomit, aes(x = Tazas_por_dia, y = Promedio)) +
  geom_point(color = "blue") +  # Puntos del gráfico
  geom_smooth(method = "lm", se = FALSE, color = "peru") + 
  labs(x = "Tazas de café por día", 
       y = "Promedio Académico", 
       title = paste0("Gráfico 3.", i), 
       subtitle = "Relación entre consumo de tazas de café por día y promedio académico") +  # Agregar subtítulo aquí
  theme_minimal()

i <- i + 1
```

#### Tiempo extra de estudio después de tomar café y promedio

```{r, echo=FALSE}
DF_completo <- DF[complete.cases(DF$Promedio,DF$Tiempo_estudio_extra_cafe),]
DF_completo <- select(DF_completo,Promedio,Tiempo_estudio_extra_cafe)

DF_completo$Tiempo_estudio_extra_cafe <- factor(DF_completo$Tiempo_estudio_extra_cafe,ordered=T,levels=c("No dedico tiempo extra","Menos de 20 minutos","Entre 20 a 40 minutos","Más de 40 minutos"))

PromediosN1 <- DF_completo$Promedio[DF_completo$Tiempo_estudio_extra_cafe=="No dedico tiempo extra"]
PromediosN2<- DF_completo$Promedio[DF_completo$Tiempo_estudio_extra_cafe=="Menos de 20 minutos"]
PromediosN3<- DF_completo$Promedio[DF_completo$Tiempo_estudio_extra_cafe=="Entre 20 a 40 minutos"]
PromediosN4<- DF_completo$Promedio[DF_completo$Tiempo_estudio_extra_cafe=="Más de 40 minutos"]

```

Tenemos los valores de la variable "promedio" agrupados por cada nivel de la variable "tiempo_extra_cafe". Su orden es ascendente y en base al tiempo, de la siguiente manera:

Nivel 1: "No dedico tiempo extra"

Nivel 2: "Menos de 20 minutos"

Nivel 3: "Entre 20 a 40 minutos"

Nivel 4: "Más de 40 minutos"

Teniendo los promedios agrupados, hallamos los principales descriptores estadísticos para cada grupo.

```{r}

summary(PromediosN1)
cat("La moda es: ",calcular_moda(PromediosN1),"\n")

summary(PromediosN2)
cat("La moda es: ",calcular_moda(PromediosN2),"\n")

summary(PromediosN3)
cat("La moda es: ",calcular_moda(PromediosN3),"\n")

summary(PromediosN4)
cat("La moda es: ",calcular_moda(PromediosN4))

```

Entre los 4 niveles, el nivel 3 (20 a 40 minutos) tiene el menor máximo (18.45), en comparación con el nivel 4 (19.80) y los niveles 1 y 2 (20.00). El nivel 4 presenta el mayor mínimo (1.00), frente al 0.00 de los demás.

Los promedios no varían significativamente entre niveles, mostrando valores similares. Esto se confirma al observar que la moda de los promedios en todos los niveles es 15, y la media y los cuartiles se mantienen cercanos.

No se observa una correlación clara entre dedicar más tiempo extra al estudio tras tomar café y obtener un mejor promedio.

Finalmente, se analizará la distribución de promedios por nivel mediante gráficos de cajas y descriptores como la desviación estándar y el coeficiente de variación.

```{r, echo=FALSE}
boxplot(DF_completo$Promedio ~ DF_completo$Tiempo_estudio_extra_cafe, data = DF_completo, main = paste0("Gráfico 3.", i), xlab = "Promedio", ylab = "Tiempo extra café", horizontal=T, names=c("N1","N2","N3","N4"))

i <- i+1
sd_cv(PromediosN1)

sd_cv(PromediosN2)

sd_cv(PromediosN3)

sd_cv(PromediosN4)
```

#### 3.2.2. Objetivo 2

#### Consumo antes del ingreso a la universidad y tazas por día

```{r}
DF_si2 <- select(DF, Consumo_antes_univ, Tazas_por_dia)
DF_si2 <- na.omit(DF_si2)
cov(DF_si2$Consumo_antes_univ, DF_si2$Tazas_por_dia)
```

```{r}
cor(DF_si2$Consumo_antes_univ, DF_si2$Tazas_por_dia)
```

En base a ambos valores podemos decir que:

-   La relación entre el consumo diario previo a la universidad y el consumo diario en la universidad es creciente. Eso lo muestra la covarianza, siendo mayor a 1. Significa que conforme más tazas de café tomaba un estudiante antes de ingresar, más tazas tomará al ingresar.

-   Tienen una relación creciente débil (entre 0 y 0.6). Y tiene sentido: solo hay cierta cantidad de tazas de café que un humano puede tomar al día, cosa que limita el incremento que pueda tener al ingresar a la universidad, por lo cual, la cantidad de tazas por día en la universidad podría terminar siendo la misma para algunos que tomasen café antes y algunos que no, perjudicando a la correlación.

```{r, echo=FALSE}
resultados <- lm(DF_si2$Tazas_por_dia~DF_si2$Consumo_antes_univ, data = DF_si2)
plot(DF_si2$Consumo_antes_univ, DF_si2$Tazas_por_dia, xlab="Tazas de café diarias antes de la universidad", ylab="Tazas de café diarias en la universidad", col = "pink")
abline(resultados, col="skyblue")
title(main=paste0("Gráfico 3.", i), sub="Relación entre el consumo de tazas antes y durante la universidad")
i<i+1
```

```{r, echo=FALSE}
pairs(~Consumo_antes_univ+Tazas_por_dia, data = DF_si2, col="pink", main = paste0("Gráfico 3.", i))
title(sub="Relación entre el consumo de café antes y durante la universidad")
i<-i+1
```

La primera gráfica confirma que la mayoría de personas que no tomaban café antes empezaron a consumir poco, mientras que aquellos que ya lo consumían, aumentaron su ingesta. Sin embargo, también hay un grupo significativo de nuevos estudiantes que ingieren tanto o más café que los habituales.

La segunda gráfica muestra que la tendencia general es consumir poco café, tanto antes como durante la universidad. Además, existe una correlación: quienes actualmente consumen más café, también solían consumir más antes

#### Frecuencia de reuniones y establecimiento de compra

```{r, echo=FALSE}
datos <- DF %>%
  select(Frecuencia_reunion, Frecuencia_cafeterias_semana, Establecimiento_compra) %>%  # Usa los nombres correctos
  mutate(
    Frecuencia_reunion = factor(Frecuencia_reunion, 
                                 levels = c("Nunca", "Rara vez", "Algunas veces", "Siempre"), 
                                 ordered = TRUE),
    Frecuencia_cafeterias_semana = factor(Frecuencia_cafeterias_semana, 
                                           levels = c("0", "1", "2", "3", "4 a más"), 
                                           ordered = TRUE),
    Establecimiento_compra = factor(Establecimiento_compra)
  )
```

```{r, echo=FALSE}
tabla_mosaico <- table(datos$Frecuencia_reunion, datos$Establecimiento_compra)

mosaicplot(tabla_mosaico,
           main = paste0("Gráfico 3.", i),
           xlab = "Frecuencia de Reuniones",
           ylab = "",  # Mantener en blanco para eliminar etiquetas de eje Y
           col = adjustcolor(rainbow(ncol(tabla_mosaico)), alpha.f = 0.7),
           border = "white",
           las = 1,
           cex.axis = 0.5)  

title(sub="Relación de la frecuencia de las reuniones por establecimiento de compra")
i<-i+1
```

El diagrama de mosaico revela la relación entre la frecuencia de reuniones y los lugares de consumo de café en estudiantes de UTEC. La mayoría nunca se reúne en los establecimientos evaluados, prefiriendo preparar su propio café o visitar cafeterías artesanales esporádicamente, mientras que bodegas y Starbucks son menos populares.

Los estudiantes que siempre consumen café tienden a preferir cafeterías artesanales y Starbucks, sugiriendo una cultura cafetera en este grupo que valora no solo el café, sino también el ambiente social.

#### Gasto semanal cafe y frecuencia reunión

Para el análisis bivariado entre las variables "Gasto_semanal_cafe" (numérica continua) y "Frecuencia_reunion" (categórica ordinal), primero agruparemos los valores de "Gasto_semanal_cafe" según cada nivel de "Frecuencia_reunion".

```{r}
DF_analisis <- DF[complete.cases(DF$Frecuencia_reunion, DF$Gasto_semanal_cafe),]
DF_analisis <- select(DF_analisis, Frecuencia_reunion, Gasto_semanal_cafe)

DF_analisis$Frecuencia_reunion <- factor(DF_analisis$Frecuencia_reunion, 
                                         levels = c("Nunca", "Rara vez", "Algunas veces", "Siempre"), 
                                         ordered = TRUE)

levels(DF_analisis$Frecuencia_reunion)

Gasto_FrecAlta <- DF_analisis$Gasto_semanal_cafe[DF_analisis$Frecuencia_reunion == "Siempre"]
Gasto_FrecMedia <- DF_analisis$Gasto_semanal_cafe[DF_analisis$Frecuencia_reunion == "Algunas veces"]
Gasto_FrecBaja <- DF_analisis$Gasto_semanal_cafe[DF_analisis$Frecuencia_reunion == "Rara vez"]
Gasto_FrecNula <- DF_analisis$Gasto_semanal_cafe[DF_analisis$Frecuencia_reunion == "Nunca"]

```

Con esto, tendremos los valores de la variable "Gasto_semanal_cafe" agrupados por cada nivel de la variable "Frecuencia_reunion".

```{r, echo=FALSE}

summary(Gasto_FrecAlta)
cat("La moda es: ", calcular_moda(Gasto_FrecAlta), "\n")

summary(Gasto_FrecMedia)
cat("La moda es: ", calcular_moda(Gasto_FrecMedia), "\n")

summary(Gasto_FrecBaja)
cat("La moda es: ", calcular_moda(Gasto_FrecBaja), "\n")

summary(Gasto_FrecNula)
cat("La moda es: ", calcular_moda(Gasto_FrecNula), "\n")

```

"Rara vez" tiene el mayor gasto semanal máximo (300 soles), y "Algunas veces" el menor (150 soles). El gasto mínimo es 0 en todos los niveles, excepto en "Siempre" (3 soles).

El rango del gasto varía poco entre niveles, con medias y percentiles mayores en niveles más altos de reunión. Las modas varían: "Algunas veces" y "Rara vez" (20 soles), "Siempre" (50 soles), "Nunca" (10 soles).

No hay una relación clara entre la frecuencia de reunión y un aumento significativo en el gasto semanal en café.

```{r, echo=FALSE}
# gasto semanal por frecuencia de reunión


par(mar = c(5, 12, 6, 2))  


boxplot(DF_analisis$Gasto_semanal_cafe ~ DF_analisis$Frecuencia_reunion, 
        main = paste0("Gráfico 3.", i),
        xlab = "Gasto Semanal en Café", ylab = "",  
        col = "gray", horizontal = TRUE,
        las = 1, cex.axis = 0.7, cex.lab = 0.7, cex.main = 0.7)  

title(sub="Distribución del Gasto Semanal por Frecuencia de Reunión")

```

```{r, echo=FALSE}

# Análisis de la desviación estándar y coeficiente de variación para cada grupo
sd_cv(Gasto_FrecAlta)

sd_cv(Gasto_FrecMedia)

sd_cv(Gasto_FrecBaja)

sd_cv(Gasto_FrecNula)
```

El análisis muestra que las distribuciones de "Frecuencia de Reunión" son similares, pero varían en valores atípicos y dispersión. "Siempre" tiene la mayor desviación estándar (53.64) y coeficiente de variación (113.4%), indicando mayor dispersión. "Nunca" presenta la menor media y el coeficiente de variación más alto (137.05%), sugiriendo inconsistencia en sus gastos, aunque son menores.

En general, las medianas no difieren significativamente, pero "Nunca" y "Rara vez" muestran mayor variación respecto a sus medias, mientras que quienes se reúnen con más frecuencia tienen un gasto más consistente.

## 4. Análisis probabilístico

### 4.1. Probabilidad empírica

#### 4.1.1. Experimento 1

Definimos el primer experimento como: "Seleccionar al azar un estudiante del estudio y observar su rendimiento académico diferenciándolo en: "Desaprobado", "Aprobado" y "Sobresaliente"".

El espacio muestral incluye todos los estudiantes clasificados por sus promedios académicos en tres categorías:

-   **Desaprobado**: Promedio \[0, 11\>.
-   **Aprobado**: Promedio \[11, 17\>.
-   **Sobresaliente**: Promedio \[17, 20\].

$\Omega{EA{1}} = {\text{Mal rendimiento, Rendimiento intermedio, Buen rendimiento}}$

**Eventos atómicos**:

1\. Evento 1: Seleccionar un estudiante "Desaprobado".

2\. Evento 2: Seleccionar un estudiante "Aprobado".

3\. Evento 3: Seleccionar un estudiante "Sobresaliente".

```{r, echo=FALSE, results='asis'}
i <- 1
total_estudiantes <- nrow(DF)

DF_categorias <- data.frame(
  Categoria = c("Desaprobado", "Aprobado", "Sobresaliente"),
  Frecuencia = c(
    sum(DF$Promedio >= 0 & DF$Promedio < 11, na.rm = TRUE),
    sum(DF$Promedio >= 11 & DF$Promedio < 17, na.rm = TRUE),
    sum(DF$Promedio >= 17 & DF$Promedio <= 20, na.rm = TRUE)
  )
)

# Calcula las probabilidades
DF_categorias$Probabilidad <- DF_categorias$Frecuencia / total_estudiantes

# Gráfico de barras
bar <- barplot(
  DF_categorias$Probabilidad,
  names.arg = DF_categorias$Categoria,
  main = paste0("Gráfico 4.1.", i),
  xlab = "Criterio",
  ylab = "Probabilidad",
  col = "lightgray",
  ylim = c(0, max(DF_categorias$Probabilidad) + 0.2) # Ajuste de altura
)

# Añadir etiquetas de las probabilidades y frecuencias encima de las barras
text(
  x = bar, 
  y = DF_categorias$Probabilidad + 0.1, 
  labels = paste0(round(DF_categorias$Probabilidad, 3), " (", DF_categorias$Frecuencia, ")"),  
  cex = 1, 
  col = "black" 
)

i <- i + 1

```

```{r, echo=FALSE}
ea <- DF_categorias
ea$Probabilidad <- r(ea$Probabilidad*100)
ea
```

#### 4.1.2. Experimento 2

Seleccionar al azar un estudiante del estudio y observar su consumo diario de café en tazas.

#### Espacio muestral

El espacio muestral está compuesto por todos los estudiantes con su consumo diario de café, organizados en tres categorías según el siguiente criterio:

-   **Normal:** estudiantes que consumen de 0 a 3 tazas por día.
-   **Intermedio:** estudiantes que consumen de 4 a 8 tazas por día.
-   **Excesivo:** estudiantes que consumen de 9 a 15 tazas por día.

Entonces los valores únicos del espacio muestral son:

$\Omega_{EA_{2}}$ : {Normal, Intermedio, Excesivo}

```{r, echo=FALSE, results='asis'}

total_estudiantes <- nrow(DF)

DF_categorias_cafe <- data.frame(
  Categoria = c("Normal", "Intermedio", "Excesivo"),
  Frecuencia = c(
    sum(DF$Tazas_por_dia >= 0 & DF$Tazas_por_dia <= 3, na.rm = TRUE),
    sum(DF$Tazas_por_dia >= 4 & DF$Tazas_por_dia <= 8, na.rm = TRUE),
    sum(DF$Tazas_por_dia >= 9 & DF$Tazas_por_dia <= 15, na.rm = TRUE)
  )
)

# Calcula las probabilidades
DF_categorias_cafe$Probabilidad <- DF_categorias_cafe$Frecuencia / total_estudiantes

# Gráfico de barras
barplot(
  DF_categorias_cafe$Probabilidad,
  names.arg = DF_categorias_cafe$Categoria,
  main = paste0("Gráfico 4.1.", i),
  xlab = "Categoría de consumo",
  ylab = "Probabilidad",
  col = "lightgray",
  ylim = c(0, max(DF_categorias_cafe$Probabilidad) + 0.1)
)

# Añadir etiquetas de las probabilidades encima de las barras
text(
  x = barplot(
    DF_categorias_cafe$Probabilidad, 
    plot = FALSE
  ),
  y = DF_categorias_cafe$Probabilidad + 0.05, 
    labels = paste0(round(DF_categorias_cafe$Probabilidad, 3), " (", DF_categorias_cafe$Frecuencia, ")"),
  cex = 1, 
  col = "black"
)

i <- 1 + i

```

```{r, echo=FALSE}
ea <- DF_categorias_cafe
ea$Probabilidad <- r(ea$Probabilidad*100)
ea
```

El 87.16% de los estudiantes de UTEC consume entre 0 y 3 tazas de café al día, siguiendo el máximo recomendado para evitar efectos negativos en la salud. Un 11.9% consume entre 4 y 8 tazas, mientras que solo el 0.95% llega a 9-15 tazas diarias. Comparando con el modelo teórico, la mayoría mantiene un consumo seguro dentro de los límites recomendados.

#### 4.1.3. Experimento 3

Seleccionar un estudiante al azar del estudio y observar su frecuencia de reunión para tomar café. El espacio muestral se compone de los estudiantes según su frecuencia de reunión: Nunca, Rara vez, Algunas veces, Siempre. Los eventos atómicos son seleccionar un estudiante que nunca, rara vez, algunas veces o siempre se reúne para tomar café.

$\Omega_{EA_{2}}$={Nunca, Rara vez, Algunas veces, Siempre}

```{r, echo=FALSE, results='asis'}
DF_frecuencia_reunion <- data.frame(
  Categoria = c("Nunca", "Rara vez", "Algunas veces", "Siempre"),
  Frecuencia = c(
    sum(DF$Frecuencia_reunion == "Nunca", na.rm = TRUE),
    sum(DF$Frecuencia_reunion == "Rara vez", na.rm = TRUE),
    sum(DF$Frecuencia_reunion == "Algunas veces", na.rm = TRUE),
    sum(DF$Frecuencia_reunion == "Siempre", na.rm = TRUE)
  )
)

DF_frecuencia_reunion$Probabilidad <- DF_frecuencia_reunion$Frecuencia / nrow(DF)

bar_positions <- barplot(
  DF_frecuencia_reunion$Probabilidad,
  names.arg = DF_frecuencia_reunion$Categoria,
  main = paste0("Gráfico 4.1.", i),
  xlab = "Frecuencia de Reunión",
  ylab = "Probabilidad",
  col = "lightgrey",
  ylim = c(0, max(DF_frecuencia_reunion$Probabilidad) + 0.1)
)


text(
  x = bar_positions,
  y = DF_frecuencia_reunion$Probabilidad + 0.02,
  labels = paste0(
    round(DF_frecuencia_reunion$Probabilidad, 3),
    " (", DF_frecuencia_reunion$Frecuencia, ")"
  ),
  cex = 0.8,
  col = "black"
)

title(sub="Probabilidad de Frecuencia de Reunión para Tomar Café")
```

```{r, echo=FALSE, results='asis'}
suma_probabilidades <- sum(DF_frecuencia_reunion$Probabilidad)

# Mostrar el resultado
cat("Suma de las probabilidades: ", suma_probabilidades, "\n")
```

```{r, echo=FALSE}
ea <- DF_frecuencia_reunion
ea$Probabilidad <- r(ea$Probabilidad*100)
ea
```

Empíricamente, encontramos que el 35.32% de los estudiantes de UTEC nunca asisten a reuniones. El 37.93% de los estudiantes rara vez asiste a reuniones, lo cual representa la mayor frecuencia en esta categoría. Un 24.26% de los estudiantes asiste a reuniones algunas veces, mientras que solo el 2.5% de los estudiantes asiste siempre a las reuniones. Esto sugiere que la mayoría de los estudiantes de UTEC se reúnen ocasionalmente o muy poco, siendo poco común que haya una asistencia constante a reuniones para tomar café.

### 4.2. Probabilidad condicional

#### 4.2.1. Primer caso

$E_1$ = Seleccionar un estudiante al azar con un promedio aprobatorio.

$E_{2}$ = Seleccionar un estudiante al azar que consume de 0 a 3 tazas de café el día del examen.

```{r, echo=FALSE, results='asis'}
i <- 1
n_total <- nrow(DF)

# Estudiantes que tienen promedio aprobatorio
DF_PA <- filter(DF, Promedio >= 11 & Promedio <= 20)
n_PA <- nrow(DF_PA)

# Estudiantes que consumen entre 0 a 3 tazas de café en un día de examen
DF_consumen_cafe <- filter(DF, Consumo_examen_dia >= 0 & Consumo_examen_dia <= 3)
n_cafe <- nrow(DF_consumen_cafe)

# Estudiantes que cumplen ambos criterios
DF_PA2 <- filter(DF, Promedio >= 11 & Promedio <= 20 & Consumo_examen_dia >= 0 & Consumo_examen_dia <= 3)
n_PA_cafe <- nrow(DF_PA2)

grid.newpage()
a <- draw.pairwise.venn(
  area1 = n_PA,
  area2 = n_cafe,
  cross.area = n_PA_cafe,
  category = c("Promedio Aprobatorio", "0-3 Tazas de Café"),
  fill = c("lightblue", "lightpink"),
  lty = "blank",
  cex = 1.5,
  cat.cex = 1.5,
  cat.pos = c(-15, 15),
  cat.dist = 0.05,
  filename = NULL,
  lwd = 2,
  )

```

```{r, echo=FALSE, results='asis'}
"Probabilidad de E1"
P_E1<-nrow(DF_PA)/nrow(DF)
round(P_E1,2)

"Probabilidad de E2"
P_E2<-nrow(DF_consumen_cafe)/nrow(DF)
round(P_E2,2)

"Probabilidad de E1 intersección E2" # DF_PA2 fue definido anteriormente
P_E1nE2 <- nrow(DF_PA2)/nrow(DF)
round(P_E1nE2,2)

"Independencia"
round(P_E1nE2,2) == round(P_E1*P_E2,2)
```

$$
P(E_1 \cap E_2) = P(E_1) \cdot P(E_2) \Rightarrow E_1 \text{ y } E_2 \text{ son independientes}
$$

#### 4.2.2. Segundo caso

Evaluar la probabilidad de que un estudiante seleccionado prefiera Starbucks o una cafetería artesanal si se sabe que gasta hasta 50 soles a la semana en café y también si se sabe que gasta entre 50 y 100 soles a la semana.

Evento 1 ($E_1$): Gasto semanal Bajo \[0, 50\>.

Evento 2 ($E_2$): Gasto semanal \[50, 100\].

Evento 3 ($E_3$): Seleccionar estudiantes de UTEC que vayan a Starbucks o cafeterías artesanales.

#### Evaluar condicionales:

1.  $P(E_3|E_1)$: Probabilidad de que un estudiante frecuente Starbucks o cafeterías artesanales si gasta hasta 50 soles semanalmente.
2.  $P(E_3|E_2)$: Probabilidad de que un estudiante frecuente Starbucks o cafeterías artesanales si gasta entre 50 y 100 soles semanalmente.

```{r, echo=FALSE, results='asis'}
DF_g1 <- filter(DF, Gasto_semanal_cafe < 50)
DF_g2 <- filter(DF, Gasto_semanal_cafe >= 50 & Gasto_semanal_cafe <= 100)
DF_ec <- filter(DF, Establecimiento_compra %in% c("Starbucks", "Cafetería Artesanal"))

# Intersecciones
DF_g1_ec <- filter(DF, Gasto_semanal_cafe < 50 & Establecimiento_compra %in% c("Starbucks", "Cafetería Artesanal")) # E3 ∩ E1
DF_g2_ec <- filter(DF, Gasto_semanal_cafe >= 50 & Gasto_semanal_cafe <= 100 & Establecimiento_compra %in% c("Starbucks", "Cafetería Artesanal")) # E3 ∩ E2

# Probabilidades
P_g1 <- nrow(DF_g1) / nrow(DF)
P_g2 <- nrow(DF_g2) / nrow(DF)
P_ec <- nrow(DF_ec) / nrow(DF)

# Intersecciones y probabilidades condicionales
P_g1_ec <- nrow(DF_g1_ec) / nrow(DF)
P_ec_given_g1 <- P_g1_ec / P_g1

P_g2_ec <- nrow(DF_g2_ec) / nrow(DF)
P_ec_given_g2 <- P_g2_ec / P_g2

# Resultados
n_g1 <- nrow(DF_g1)
n_ec <- nrow(DF_ec)
n_g1_ec <- nrow(DF_g1_ec)

n_g2 <- nrow(DF_g2)
n_g2_ec <- nrow(DF_g2_ec)

```

```{r, echo=FALSE, results='asis'}
# Añadir la columna de frecuencias al dataframe de probabilidades
DF_probabilidades <- data.frame(
  Evento = c("P(E1)", "P(E2)", "P(E3)", "P(E3|E1)", "P(E3|E2)"),
  Probabilidad = r(c(P_g1, P_g2, P_ec, P_ec_given_g1, P_ec_given_g2)),
  Frecuencia = c(n_g1, n_g2, n_ec, n_g1_ec, n_g2_ec)
)

DF_probabilidades


```

```{r, echo=FALSE, results='asis'}
i <- 1
# Crear la tabla de contingencia para el gráfico de mosaico
tabla_contingencia <- matrix(c(
  n_g1 - n_g1_ec,  # Estudiantes que gastan <50 y no van a Starbucks/Cafetería
  n_g1_ec,         # Estudiantes que gastan <50 y van a Starbucks/Cafetería
  n_g2 - n_g2_ec,  # Estudiantes que gastan 50-100 y no van a Starbucks/Cafetería
  n_g2_ec          # Estudiantes que gastan 50-100 y van a Starbucks/Cafetería
), nrow = 2, byrow = TRUE)

colnames(tabla_contingencia) <- c("Otro", "Starbucks/Cafetería")
rownames(tabla_contingencia) <- c("<50", "50-100")

# Colores tenues para los mosaicos
colores <- c("lightblue", "lightpink")

# Crear el gráfico de mosaico con colores y frecuencias
mosaicplot(tabla_contingencia, 
           main = paste0("Gráfico 4.2.", i) , 
           xlab = "Establecimiento", 
           ylab = "Gasto", 
           color = colores, 
           border = "gray")

title(sub= "Gráfico de Mosaico de Probabilidades Condicionales")

```

#### Prueba de independencia

```{r, echo=FALSE, results='asis'}
independencia_g1_ec <- round(P_g1_ec, 2) == round(P_g1 * P_ec, 2)

paste("¿E1 y E3 son independientes?:", independencia_g1_ec)

independencia_g2_ec <- round(P_g2_ec, 2) == round(P_g2 * P_ec, 2)

paste("¿E2 y E3 son independientes?:", independencia_g2_ec)

```

$$
P(E_1 \cap E_3) = P(E_1) \cdot P(E_3) \Rightarrow E_1 \text{ y } E_3 \text{ No son independientes}
$$

$$
P(E_2 \cap E_3) = P(E_2) \cdot P(E_3) \Rightarrow E_2 \text{ y } E_3 \text{ No son independientes}
$$

### 4.3. Variables aleatorias

#### 4.3.1. Discretas

#### 4.3.1.1. Tiempo de estudio extra al consumir café

Se desea conocer la probabilidad de encontrar 20 estudiantes que estudian más de 40 minutos si se toma una muestra de 30 estudiantes.

```{r, echo=FALSE, results='asis'}
i < i + 1
de1 <- prop.table(table(DF$Tiempo_estudio_extra_cafe))

barp <- barplot(
  de1,
  main = paste0("Gráfico 4.3.1.", i) , 
  
  col = "lightgray",
  xlab = "Rangos de tiempo",
  ylab = "Probabilidad",
  ylim = c(0, max(de1) + 0.05), 
  cex.names = 0.6
)


text(
  x = barp,                      
  y = de1 + 0.01,                
  labels = round(de1,2), 
  cex = 0.8,                     
  col = "black",                 
  pos = 3                       
)

title(sub= "Probabilidades de estudiar tiempo extra después de consumir café")
```

```{r}
m <- nrow(DF) # Total de estudiantes
DF_de1 <- filter(DF, Tiempo_estudio_extra_cafe == "Más de 40 minutos") # DF con casos de Éxito
n <- nrow(DF_de1) # Num de casos de exito 
k <- 30
x <- 20
print(n)
```

Teniendo en cuenta que el número total de estudiantes es 841, nuestra muestra 30 y buscamos 20 casos de éxito procederemos a encontrar el número de éxitos en la población inicial. Haciendo un filtrado simple podemos saber que este mismo es 346.

Conociendo estos datos podemos hallar las siguientes propiedades:

```{r}
Ex <- k*(n/m)
Vx <- k*(n/m)*((m-n)/m)*((m-k)/(m-1)) 
cv <- sqrt(Vx)/Ex

paste("E(X):", r(Ex))
paste("V(X):", r(Vx))
paste("CV:", r(cv))
```

Ahora, hallaremos la probabilidad del caso propuesto con la fórmula \`dhyper\`:

```{r}
pe1 <- dhyper(x, m, n, k)
paste("P(X):",r(pe1))
```

#### 4.3.1.2. Frecuencia de reunión en cafeterías

Se evaluará la variable 6. Se desea conocer la probabilidad de que, al seleccionar 10 estudiantes al azar con reposición, al menos la mitad de ellos tengan una frecuencia de reunión de "Algunas veces" o de "Siempre".

```{r, echo=FALSE, results='asis'}
i <- i + 1
de2 <- prop.table(table(DF$Frecuencia_reunion))

barp <- barplot(
  de2,
  main = paste0("Gráfico 4.3.1.",i),
  col = "lightgray",
  xlab = "Frecuencias de reunión",
  ylab = "Probabilidad",
  ylim = c(0, max(de2) + 0.05), 
  cex.names = 0.6
)


text(
  x = barp,                      
  y = de2 + 0.01,                
  labels = round(de2,2), 
  cex = 0.8,                     
  col = "black",                 
  pos = 3                       
)

title(sub="Probabilidades de frecuencias de reunión para tomar café")
```

```{r}
#Cantidad de exitos acumulados deseados (la mitad de la muestra a seleccionar)
x=5

#Cantidad de alumnos seleccionados (ensayos o replicas realizadas)
n=10

#Probabilidad empirica del exito
p=sum(DF$Frecuencia_reunion %in% c("Siempre","Algunas veces"))/nrow(DF)

```

A partir del reconocimiento de estos parametros podemos hallar la media esperada, la varianza y el coeficiente de variación:

```{r, echo=TRUE, results='asis'}
Ex2 <- n*p
Vx2 <- n*p*(1-p)
CVx2 <- sqrt(Vx)/Ex

paste("E(X):", r(Ex2))
paste("V(X):", r(Vx2))
paste("CV:", r(CVx2))
```

Por último, hallamos la probabilidad del evento propuesto con \`pbinom\`:

```{r}
#Calculo de la probabilidad
pe2 <- pbinom(x,n,p,lower.tail = FALSE)
paste("P(X):",r(pe2))
```

#### 4.3.2. Continuas

#### 4.3.2.1. Gasto semanal en café

Para analizar la variable promedio, primero se debe graficar un histograma con los datos correspondientes y hacer las curvas Empíricas y Normales para verificar si corresponden a este modelo.

```{r, echo=FALSE, results='asis'}
i <- 1
hist(DF$Gasto_semanal_cafe, 
     breaks = 45, 
     probability = TRUE, 
     main = paste0("Gráfico 4.3.2.",i),
     
     col = "lightblue")

# Línea de densidad empírica
lines(density(DF$Gasto_semanal_cafe, na.rm = TRUE), lwd = 3, col = "red")

# Línea de densidad teórica (distribución normal)
lines(seq(min(DF$Gasto_semanal_cafe, na.rm = TRUE), 
          max(DF$Gasto_semanal_cafe, na.rm = TRUE), 
          length.out = 100),
      dnorm(seq(min(DF$Gasto_semanal_cafe, na.rm = TRUE), 
                max(DF$Gasto_semanal_cafe, na.rm = TRUE), 
                length.out = 100),
            mean = mean(DF$Gasto_semanal_cafe, na.rm = TRUE),
            sd = sd(DF$Gasto_semanal_cafe, na.rm = TRUE)),
      lwd = 2, col = "darkgreen")

legend("topright", legend = c("Empírica", "Normal"),
       col = c("red", "darkgreen"), lwd = 2)

title(sub="Gráfico del Gasto semanal en café")

```

Como se puede observar, el ajuste apropiado no sería el Normal. Observando mejor, podemos darnos cuenta que un mejor ajuste sería el exponencial así que, calculando la tasa lambda podemos graficar la curva:

```{r, echo=FALSE, results='asis'}
i <- i+1
# Calcular la tasa lambda para la distribución exponencial
lambda <- 1 / mean(DF$Gasto_semanal_cafe)

# Crear el histograma con la densidad empírica
hist(DF$Gasto_semanal_cafe, 
     breaks = 45, 
     probability = TRUE, 
     main = paste0("Gráfico 4.3.2.",i),
     col = "lightblue")

# Línea de densidad empírica
lines(density(DF$Gasto_semanal_cafe, na.rm = TRUE), lwd = 3, col = "red")

# Superponer la curva de densidad teórica (distribución exponencial)
curve(dexp(x, rate = lambda), col = "blue", lwd = 2, add = TRUE)

# Añadir leyenda
legend("topright", legend = c("Empírica", "Exponencial Ajustada"),
       col = c("red", "blue"), lwd = 2)
title(sub="Gráfico del Gasto semanal en café")
```

Ahora, podemos hallar las siguientes propiedades:

```{r echo=FALSE, results='asis'}

lambda <- 1 / mean(DF$Gasto_semanal_cafe)
# Calcular la esperanza (media)
esperanza <- 1 / lambda

# Calcular la varianza
varianza <- 1 / (lambda^2)

# Calcular la desviación estándar (sigma)
sigma <- sqrt(varianza)

print(paste("Tasa lambda:", r(lambda)))
print(paste("Esperanza (mu):", r(esperanza)))
print(paste("Varianza (sigma^2):", r(varianza)))
print(paste("Desviación Estándar (sigma):", r(sigma)))

```

#### 4.3.2.2. Promedio

Hacemos el mismo proceso para la variable Promedio:

```{r, echo=FALSE, results='asis'}
i <- i + 1
hist(DF$Promedio, 
     breaks = 30, 
     probability = TRUE, 
     main = paste0("Gráfico 4.3.2.",i),

     col = "lightblue")

# Línea de densidad empírica
lines(density(DF$Promedio, na.rm = TRUE), lwd = 3, col = "red")

# Línea de densidad teórica (distribución normal)
lines(seq(min(DF$Promedio, na.rm = TRUE), max(DF$Promedio, na.rm = TRUE), length.out = 100),
      dnorm(seq(min(DF$Promedio, na.rm = TRUE), max(DF$Promedio, na.rm = TRUE), length.out = 100),
            mean = mean(DF$Promedio, na.rm = TRUE),
            sd = sd(DF$Promedio, na.rm = TRUE)),
      lwd = 2, col = "darkgreen")

title(sub="Gráfico del Promedio")
```

La curva normal graficada anteriormente parece ser un ajuste verídico pero confirmaremos calculando la media, mediana y moda.

```{r, echo=FALSE, results='asis'}

moda <- calcular_moda(DF$Promedio)
print(paste("Moda:", r(moda)))

media <- mean(DF$Promedio)
print(paste("Media:", r(media)))

mediana <- median(DF$Promedio)
print(paste("Mediana:", r(mediana)))

```

Si bien los tres valores no son iguales solo por la media, se acercan mucho a ser iguales así que tomaremos el ajuste de la curva normal para esta variable. De esta manera, podemos afirmar que ya tenemos el valor de $\mu$, por lo tanto, procederemos a calcular las demás propiedades y la función de densidad.

```{r}
mu <- media
sigma <- sd(DF$Promedio, na.rm = TRUE)
print(paste("Sigma:", r(sigma)))
```

```{r}
f <- function(x) {
  (1 / (sigma * sqrt(2 * pi))) * exp(-((x - mu)^2) / (2 * sigma^2))
}
```

```{r}
esperanza <- integrate(function(x) x * f(x), 0, 20)$value
cat("Valor esperado E(X) =", r(esperanza), "\n")
```

```{r}
# Calcular la integral para obtener E(X^2) en el rango [0, 20]
expected_square <- integrate(function(x) x^2 * f(x), 0, 20)$value

# Calcular la varianza Var(X)
variance <- expected_square - esperanza^2
cat("Varianza Var(X) =", r(variance), "\n")
```

## 5. Conclusiones

Esta investigación analiza el consumo de café y su impacto en los estudiantes de pregrado de la UTEC durante el semestre académico 2024-II, revelando patrones interesantes.

Los resultados muestran que el consumo de café está asociado con un incremento moderado en el tiempo de estudio, pero no se traduce en una mejora sustancial del rendimiento académico. Los promedios de calificaciones permanecen constantes y la moda es 15. El 71% de los estudiantes que consumen entre 0 y 3 tazas diarias mantienen un promedio aprobatorio, lo que sugiere que el consumo moderado no afecta negativamente, aunque tampoco es un factor decisivo.

Respecto a los hábitos de consumo, la mayoría de los estudiantes consume poco café, prefiriendo prepararlo en casa o visitar cafeterías artesanales ocasionalmente. Los consumidores frecuentes, en cambio, suelen acudir a cafeterías artesanales o tiendas reconocidas, reflejando una cultura cafetera más desarrollada.

El impacto autopercibido del café en el rendimiento académico es positivo, pero moderado. Además, se identifica la presencia de una cultura cafetera entre los estudiantes habituales.

Entre las limitaciones destacan la limpieza de datos, que redujo la muestra a 841 estudiantes, y posibles sesgos en las respuestas.
